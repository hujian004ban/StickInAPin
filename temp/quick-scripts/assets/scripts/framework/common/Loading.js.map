{"version":3,"sources":["Loading.js"],"names":["Loading","cc","Class","extends","Component","statics","loadingNode","loadingComponent","show","loadingName","isValid","zy","Node","createNode","name","width","constData","DesignSize","height","zIndex","ZIndex","LOADING","parent","director","getUiRoot","addComponent","init","hide","properties","loadingList","node","BlockInputEvents","maskNode","Sprite","url","size","loadCallback","err","bind","Label","string","systemFont","active","indexOf","push","stopAllActions","delaySeq","sequence","delayTime","callFunc","runAction","index","splice","length","clean"],"mappings":"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","file":"Loading.js","sourceRoot":"../../../../../../assets/scripts/framework/common","sourcesContent":["/**\n * Created by skyxu on 2019/11/28.\n */\n\nlet Loading = cc.Class({\n    extends: cc.Component,\n\n    statics: {\n        // loading\n        loadingNode: null,\n        loadingComponent: null,\n\n        // 显示Loading\n        show: function (loadingName) {\n            if (!cc.isValid(this.loadingNode)) {\n                this.loadingNode = zy.Node.createNode({\n                    name: 'loading',\n                    width: zy.constData.DesignSize.width * 2,\n                    height: zy.constData.DesignSize.width * 2,\n                    zIndex: zy.constData.ZIndex.LOADING,\n                    parent: zy.director.getUiRoot(),\n                });\n                this.loadingComponent = this.loadingNode.addComponent('Loading');\n                this.loadingComponent.init();\n            }\n\n            this.loadingComponent.show(loadingName);\n\n        },\n\n        // 隐藏Loading\n        hide: function (loadingName) {\n            if (cc.isValid(this.loadingNode)) {\n                this.loadingComponent.hide(loadingName);\n            }\n        },\n    },\n\n    properties: {},\n\n    init: function () {\n        // 当前显示的loading列表\n        this.loadingList = [];\n\n        // 控制触摸\n        this.node.width = zy.constData.DesignSize.width * 2;\n        this.node.height = zy.constData.DesignSize.height * 2;\n        this.node.addComponent(cc.BlockInputEvents);\n\n        // 黑色遮罩\n        this.maskNode = zy.Sprite.createNode({\n            name: 'maskNode',\n            url: 'textures/common/mask',\n            parent: this.node,\n            size: cc.size(zy.constData.DesignSize.width * 2, zy.constData.DesignSize.height * 2),\n            loadCallback: function (err, node) {\n                node.width = zy.constData.DesignSize.width * 2;\n                node.height = zy.constData.DesignSize.height * 2;\n            }.bind(this),\n        });\n\n        // todo: loading动画\n        zy.Label.createNode({\n            string: \"Loading...\",\n            parent: this.maskNode,\n            systemFont: false,\n        });\n        this.maskNode.active = false;\n    },\n\n    show: function (name) {\n        // 存在当前loading\n        if (this.loadingList.indexOf(name) == -1) {\n            this.loadingList.push(name);\n        }\n\n        this.node.active = true;\n\n        this.node.stopAllActions();\n\n        let delaySeq = cc.sequence(\n            cc.delayTime(1), // 先有遮罩一秒钟后才触发loading,\n            cc.callFunc(function () {\n                this.delaySeq = null;\n                this.maskNode.active = true;\n            }.bind(this))\n        );\n\n        this.node.runAction(delaySeq);\n    },\n\n    hide: function (name) {\n        // 存在当前loading\n        const index = this.loadingList.indexOf(name);\n        if (index > -1) {\n            this.loadingList.splice(index, 1);\n        }\n\n        if (this.loadingList.length == 0) {\n            this.node.active = false;\n            this.maskNode.active = false;\n        }\n    },\n\n    clean: function () {\n        this.node.active = false;\n        this.loadingList = [];\n    }\n});"]}