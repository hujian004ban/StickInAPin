{"version":3,"sources":["Button.js"],"names":["mat4","_mat4","m00","m01","m02","m03","m04","m05","m06","m07","m08","m09","m10","m11","m12","m13","m14","m15","create","invert","out","a","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","a30","a31","a32","a33","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","b11","det","vec2","transformMat4","m","x","y","math","_mat4_temp","Button","cc","Class","extends","statics","createNode","params","node","Node","addComponent","zy","Sprite","updateNode","button","getComponent","eventHandler","hasOwnProperty","touchAction","commonClickAudio","clickEventHandler","Component","EventHandler","target","component","customEventData","handler","clickEvents","push","enableAutoGrayEffect","interactable","properties","override","default","tooltip","isPolygonCollider","polygonPoints","visible","CC_DEV","type","Vec2","brightTargets","onLoad","touchScaleAction","touchScaleRatio","CC_EDITOR","_polygonCheckRect","_point","point","convertToNodeSpaceAR","width","height","i","j","c","nvert","length","_polygonCheckIn","_hitTest","listener","w","_contentSize","h","cameraPt","v2","testPt","camera","Camera","findCamera","getScreenToWorldPoint","set","_updateWorldMatrix","_worldMatrix","_anchorPoint","minX","minY","_pressed","offsetX","nodeScaleX","offsetY","nodeScaleY","mask","parent","index","comp","Mask","enabledInHierarchy","_onTouchBegan","event","_super","_setBrightEffect","stopAction","scaleX","scaleY","sequence","scaleTo","callFunc","bind","runAction","_onTouchMove","_onTouchEnded","audio","playEffect","Effect","CommonClick","_resetScale","emitEvents","emit","_updateState","stopPropagation","_endTouchScaleAction","_onTouchCancel","bright","shader","shaderUtils","Bright","Normal","_node","state","getState","setShader","setState","sp","Skeleton","onDisable","module","exports"],"mappings":"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","file":"Button.js","sourceRoot":"../../../../../../assets/scripts/framework/ui","sourcesContent":["/**\n * Created by skyxu on 2019/11/27.\n * 适用于ccc2.x版本\n */\n\n\n//2.0 HitTest\n\n var mat4 = {};\n var _mat4 = function _mat4(\n m00, m01, m02, m03,\n m04, m05, m06, m07,\n m08, m09, m10, m11,\n m12, m13, m14, m15\n ) {\n    this.m00 = m00;\n    this.m01 = m01;\n    this.m02 = m02;\n    this.m03 = m03;\n    this.m04 = m04;\n    this.m05 = m05;\n    this.m06 = m06;\n    this.m07 = m07;\n    this.m08 = m08;\n    this.m09 = m09;\n    this.m10 = m10;\n    this.m11 = m11;\n    this.m12 = m12;\n    this.m13 = m13;\n    this.m14 = m14;\n    this.m15 = m15;\n  };\n mat4.create = function () {\n    return new _mat4(\n      1, 0, 0, 0,\n      0, 1, 0, 0,\n      0, 0, 1, 0,\n      0, 0, 0, 1\n    );\n  };\n\n mat4.invert = function (out, a) {\nvar a00 = a.m00, a01 = a.m01, a02 = a.m02, a03 = a.m03,\n    a10 = a.m04, a11 = a.m05, a12 = a.m06, a13 = a.m07,\n    a20 = a.m08, a21 = a.m09, a22 = a.m10, a23 = a.m11,\n    a30 = a.m12, a31 = a.m13, a32 = a.m14, a33 = a.m15;\n\nvar b00 = a00 * a11 - a01 * a10;\nvar b01 = a00 * a12 - a02 * a10;\nvar b02 = a00 * a13 - a03 * a10;\nvar b03 = a01 * a12 - a02 * a11;\nvar b04 = a01 * a13 - a03 * a11;\nvar b05 = a02 * a13 - a03 * a12;\nvar b06 = a20 * a31 - a21 * a30;\nvar b07 = a20 * a32 - a22 * a30;\nvar b08 = a20 * a33 - a23 * a30;\nvar b09 = a21 * a32 - a22 * a31;\nvar b10 = a21 * a33 - a23 * a31;\nvar b11 = a22 * a33 - a23 * a32;\n\n// Calculate the determinant\nvar det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\nif (!det) {\n    return null;\n}\ndet = 1.0 / det;\n\nout.m00 = (a11 * b11 - a12 * b10 + a13 * b09) * det;\nout.m01 = (a02 * b10 - a01 * b11 - a03 * b09) * det;\nout.m02 = (a31 * b05 - a32 * b04 + a33 * b03) * det;\nout.m03 = (a22 * b04 - a21 * b05 - a23 * b03) * det;\nout.m04 = (a12 * b08 - a10 * b11 - a13 * b07) * det;\nout.m05 = (a00 * b11 - a02 * b08 + a03 * b07) * det;\nout.m06 = (a32 * b02 - a30 * b05 - a33 * b01) * det;\nout.m07 = (a20 * b05 - a22 * b02 + a23 * b01) * det;\nout.m08 = (a10 * b10 - a11 * b08 + a13 * b06) * det;\nout.m09 = (a01 * b08 - a00 * b10 - a03 * b06) * det;\nout.m10 = (a30 * b04 - a31 * b02 + a33 * b00) * det;\nout.m11 = (a21 * b02 - a20 * b04 - a23 * b00) * det;\nout.m12 = (a11 * b07 - a10 * b09 - a12 * b06) * det;\nout.m13 = (a00 * b09 - a01 * b07 + a02 * b06) * det;\nout.m14 = (a31 * b01 - a30 * b03 - a32 * b00) * det;\nout.m15 = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n\nreturn out;\n};\n\n var vec2 = {};\n vec2.transformMat4 = function (out, a, m) {\n    var x = a.x,\n        y = a.y;\n    out.x = m.m00 * x + m.m04 * y + m.m12;\n    out.y = m.m01 * x + m.m05 * y + m.m13;\n    return out;\n  };\n\n var math = {\n    mat4: mat4,\n    vec2: vec2,\n};\n\nvar _mat4_temp = math.mat4.create();\n\nconst Button = cc.Class({\n    extends: cc.Button,\n\n    statics: {\n        // 工厂方法\n        createNode: function (params) {\n            let node = new cc.Node();\n            node.addComponent(zy.Sprite);\n            zy.Sprite.updateNode(node, params);\n\n            node.addComponent(zy.Button);\n\n            zy.Button.updateNode(node, params);\n\n            return node;\n        },\n\n        // 更新ButtonNode\n        updateNode: function (node, params) {\n            let button = node.getComponent(zy.Button);\n            if (!button) {\n                button = node.getComponent(cc.Button);\n            }\n\n            let eventHandler = params.eventHandler;\n\n            if (params.hasOwnProperty('touchAction')) {\n                button.touchAction = params.touchAction;\n            }\n\n            if (params.hasOwnProperty('commonClickAudio')) {\n                button.commonClickAudio = params.commonClickAudio;\n            }\n\n            if (eventHandler) {\n                let clickEventHandler = new cc.Component.EventHandler();\n                clickEventHandler.target = eventHandler.target; //这个 node 节点是你的事件处理代码组件所属的节点\n                clickEventHandler.component = eventHandler.component;//这个是代码文件名\n                clickEventHandler.customEventData = eventHandler.customEventData;\n                clickEventHandler.handler = eventHandler.handler;\n                button.clickEvents.push(clickEventHandler);\n            }\n\n\n            // 是否自动置灰\n            if (params.hasOwnProperty('enableAutoGrayEffect')) {\n                button.enableAutoGrayEffect = params.enableAutoGrayEffect;\n            }\n\n            // 可交互\n            if (params.hasOwnProperty('interactable')) {\n                button.interactable = params.interactable;\n            }\n\n            zy.Node.updateNode(node, params);\n        },\n    },\n\n    properties: {\n        touchAction: {\n            override: true,\n            default: true,\n            tooltip: 'display custom action',\n        },\n        commonClickAudio: {\n            default: true,\n            tooltip: 'common click audio',\n        },\n        isPolygonCollider: {\n            default: false,\n            tooltip: 'is polygon collider',\n        },\n        polygonPoints: {\n            visible: function () {\n                return this.isPolygonCollider === true;\n            },\n            tooltip: CC_DEV && 'i18n:COMPONENT.physics.physics_collider.points',\n            default: function () {\n                return [];\n            },\n            type: [cc.Vec2]\n        },\n        brightTargets: {\n            default: function () {\n                return [];\n            },\n            type: [cc.Node]\n        },\n    },\n\n    onLoad: function () {\n        this.touchScaleAction = null;\n        this.touchScaleRatio = 0.8;\n\n        // 2.2.0之后无效\n        if (!CC_EDITOR) {\n            // 重设点击区域\n            // this.node.__hitTest = this.node._hitTest;\n            // this.node._hitTest = this._hitTest;\n        }\n    },\n\n    _polygonCheckRect: function(_point){\n        let point = this.node.convertToNodeSpaceAR(_point);\n        if(point.x < -this.node.width / 2 || point.x > this.node.width / 2 || point.y < -this.node.height / 2 || point.y > this.node.height / 2)\n        {\n            return false;\n        }\n        let i, j, c = false;\n        let nvert = this.polygonPoints.length;\n        for (i = 0, j = nvert - 1; i < nvert; j = i++) {\n            if (((this.polygonPoints[i].y > point.y) != (this.polygonPoints[j].y > point.y)) &&\n                (point.x < (this.polygonPoints[j].x - this.polygonPoints[i].x) * (point.y - this.polygonPoints[i].y) / (this.polygonPoints[j].y - this.polygonPoints[i].y) + this.polygonPoints[i].x))\n                c = !c;\n        }\n        return c;\n    },\n\n    _polygonCheckIn: function(point) {\n        if (!this.isPolygonCollider || this.polygonPoints.length <= 2){\n            return true;\n        } else {\n            return this._polygonCheckRect(point);\n        }\n    },\n\n    // 2.0\n    _hitTest (point, listener) {\n        let w = this._contentSize.width,\n            h = this._contentSize.height,\n            cameraPt = cc.v2(),\n            testPt = cc.v2();\n\n        let camera = cc.Camera.findCamera(this);\n        if (camera) {\n            camera.getScreenToWorldPoint(point, cameraPt);\n        }\n        else {\n            cameraPt.set(point);\n        }\n\n        this._updateWorldMatrix();\n        math.mat4.invert(_mat4_temp, this._worldMatrix);\n        math.vec2.transformMat4(testPt, cameraPt, _mat4_temp);\n        testPt.x += this._anchorPoint.x * w;\n        testPt.y += this._anchorPoint.y * h;\n\n        // 重写判定区域\n        let minX = 0;\n        let minY = 0;\n        let button = this.getComponent(cc.Button);\n        if (button && button.touchAction && button._pressed) {\n            let offsetX = w * button.nodeScaleX * (1 - button.touchScaleRatio) / 2;\n            let offsetY = h * button.nodeScaleY * (1 - button.touchScaleRatio) / 2;\n            minX -= offsetX;\n            minY -= offsetY;\n            w += offsetX;\n            h += offsetY;\n            // cc.log(testPt.x, testPt.y, offsetX, offsetY, w, h);\n        }\n\n        if (testPt.x >= minX && testPt.y >= minY && testPt.x <= w && testPt.y <= h) {\n            if (listener && listener.mask) {\n                var mask = listener.mask;\n                var parent = this;\n                for (var i = 0; parent && i < mask.index; ++i, parent = parent.parent) {\n                }\n                // find mask parent, should hit test it\n                if (parent === mask.node) {\n                    var comp = parent.getComponent(cc.Mask);\n                    return (comp && comp.enabledInHierarchy) ? comp._hitTest(cameraPt) : true;\n                }\n                // mask parent no longer exists\n                else {\n                    listener.mask = null;\n                    return true;\n                }\n            }\n            else {\n                return true;\n            }\n        }\n        else {\n            return false;\n        }\n    },\n\n    _onTouchBegan (event) {\n        this._super(event);\n        if (!this.interactable || !this.enabledInHierarchy) return;\n\n        // 高亮 _updateState后\n        this._setBrightEffect(true);\n\n        if (!this.touchAction) return;\n\n        // cc.log('_onTouchBegan', event);\n        if (this.touchScaleAction) {\n            this.node.stopAction(this.touchScaleAction);\n            this.node.scaleX = this.nodeScaleX;\n            this.node.scaleY = this.nodeScaleY;\n        } else {\n            this.nodeScaleX = this.node.scaleX;\n            this.nodeScaleY = this.node.scaleY;\n        }\n\n        this.touchScaleAction = cc.sequence(\n            cc.scaleTo(0.08, this.touchScaleRatio * this.nodeScaleX, this.touchScaleRatio * this.nodeScaleY),\n            cc.callFunc(function () {\n                this.touchScaleAction = null;\n            }.bind(this))\n        );\n\n        this.node.runAction(this.touchScaleAction);\n    },\n\n    _onTouchMove (event) {\n        //cc.log('_onTouchMove', event);\n        this._super(event);\n        if (!this.interactable || !this.enabledInHierarchy || !this._pressed) return;\n    },\n\n    _onTouchEnded (event) {\n        // cc.log('_onTouchEnded', event);\n        // this._super(event);\n        if (this.commonClickAudio) {\n            // 通用音效\n            zy.audio.playEffect(zy.audio.Effect.CommonClick);\n        }\n        if (!this.interactable || !this.enabledInHierarchy) {\n            this._resetScale();\n            return;\n        }\n        // 高亮还原 _updateState前\n        this._setBrightEffect(false);\n\n        if (this._pressed) {\n            cc.Component.EventHandler.emitEvents(this.clickEvents, event);\n            this.node.emit('click', this);\n        }\n        this._pressed = false;\n        this._updateState();\n        event.stopPropagation();\n\n        this._endTouchScaleAction();\n\n    },\n\n    _onTouchCancel () {\n        // cc.log('_onTouchCancel');\n        // 高亮还原 _updateState前\n        this._setBrightEffect(false);\n\n        this._super();\n        if (!this.interactable || !this.enabledInHierarchy) {\n            this._resetScale();\n            return;\n        }\n        this._endTouchScaleAction();\n    },\n\n    _resetScale: function () {\n        if (!this.touchAction) return;\n\n        if (this.touchScaleAction) {\n            this.node.stopAction(this.touchScaleAction);\n            this.touchScaleAction = null;\n        }\n\n        if (this.nodeScaleX && this.nodeScaleY) {\n            this.node.scaleX = this.nodeScaleX;\n            this.node.scaleY = this.nodeScaleY;\n        }\n\n    },\n\n    _endTouchScaleAction () {\n        if (!this.touchAction) return;\n\n        if (this.touchScaleAction) {\n            this.node.stopAction(this.touchScaleAction);\n            this.node.scaleX = this.nodeScaleX * this.touchScaleRatio;\n            this.node.scaleY = this.nodeScaleY * this.touchScaleRatio;\n            this.touchScaleAction = null;\n        }\n\n        this.touchScaleAction = cc.sequence(\n            cc.scaleTo(0.08, this.nodeScaleX * 1.1, this.nodeScaleY * 1.1),\n            cc.scaleTo(0.08, this.nodeScaleX * 0.9, this.nodeScaleY * 0.9),\n            cc.scaleTo(0.08, this.nodeScaleX * 1, this.nodeScaleY * 1),\n            cc.callFunc(function () {\n                this.touchScaleAction = null;\n            }.bind(this))\n        );\n        this.node.runAction(this.touchScaleAction);\n    },\n\n    _setBrightEffect: function (bright) {\n        if (this.brightTargets.length != 0) {\n            let shader = bright ? zy.shaderUtils.Effect.Bright : zy.shaderUtils.Effect.Normal;\n\n            for (const i in this.brightTargets) {\n                let _node = this.brightTargets[i];\n                if (_node.getComponent(cc.Sprite)) {\n                    let component = _node.getComponent(cc.Sprite);\n                    let state = component.getState();\n                    // 置灰状态无高亮\n                    if (bright && state != 1) {\n                        zy.shaderUtils.setShader(component, shader);\n                    } else {\n                        component.setState(state);\n                    }\n                } else if (_node.getComponent(sp.Skeleton)) {\n                    let component = _node.getComponent(sp.Skeleton);\n                    zy.shaderUtils.setShader(component, shader);\n                }\n            }\n        }\n    },\n\n    onDisable () {\n        this._super();\n        if (!this.touchAction) return;\n\n        this._resetScale();\n\n    }\n});\n\nzy.Button = module.exports = Button;"]}