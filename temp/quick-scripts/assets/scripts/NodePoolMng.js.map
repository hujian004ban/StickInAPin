{"version":3,"sources":["NodePoolMng.js"],"names":["SHOWLOG","myLog","arg","cc","log","apply","arguments","NodePoolMng","Class","extends","Component","properties","bulletPFList","Prefab","enemyPFList","normalEffectPF","bloodDecreasePF","warningEnemy2PF","bulletCounts","enemyCounts","normalEffectCounts","warningEnemy2Counts","onLoad","zy","nodePoolMng","bulletPoolDic","bulletPFDic","enemyPoolDic","enemyPFDic","normalEffPool","bloodDecPool","warningEnemy2Pool","init","p","pool","NodePool","_name","i","b","instantiate","put","num","e","w","getBullet","name","assert","size","get","putBullet","node","getEnmey","putEnemy","getNormalEffect","putNormalEffect","getBloodDecNode","putBloodDecNode","getWarningEnemy2DecNode","putWarningEnemy2DecNode"],"mappings":"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","file":"NodePoolMng.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["/**\n * Created by skyxu on 2019/11/26.\n */\n\n// 方便统一开关log\nconst SHOWLOG = false;\n\nlet myLog = function (arg) {\n  if (SHOWLOG) {\n      cc.log.apply(cc.log, arguments);\n  }\n};\n\nlet NodePoolMng = cc.Class({\n    extends: cc.Component,\n    properties: {\n        bulletPFList: [cc.Prefab],\n        enemyPFList: [cc.Prefab],\n        normalEffectPF: cc.Prefab,\n        bloodDecreasePF: cc.Prefab,\n        warningEnemy2PF: cc.Prefab,\n\n        bulletCounts: 30,   // 子弹对象池默认数量\n        enemyCounts: 40,  //敌人对象池默认数量\n        normalEffectCounts: 30,  // 通用特效默认缓存数量\n        warningEnemy2Counts: 10,  // 敌人2的提示警告缓存数量\n    },\n\n    onLoad() {\n        zy.nodePoolMng = this;\n\n        this.bulletPoolDic = {};\n        this.bulletPFDic = {};\n\n        this.enemyPoolDic = {};\n        this.enemyPFDic = {};\n\n        this.normalEffPool = null;\n\n        this.bloodDecPool = null;\n\n        this.warningEnemy2Pool = null;\n\n        this.init();\n    },\n\n    init() {\n        // 创建子弹对象池\n        for (let p of this.bulletPFList) {\n            let pool = new cc.NodePool();\n            this.bulletPoolDic[p._name] = pool;\n            this.bulletPFDic[p._name] = p;\n            for (let i=0; i<this.bulletCounts; i++) {\n                let b = cc.instantiate(p);\n                pool.put(b);\n            }\n        }\n\n        // 创建敌人对象池\n        for (let p of this.enemyPFList) {\n            let pool = new cc.NodePool();\n            this.enemyPoolDic[p._name] = pool;\n            this.enemyPFDic[p._name] = p;\n\n            let num = this.enemyCounts;\n            if (p._name == \"enemy7\") {\n                // boss 创建一个就行了，为了方便统一使用才这样处理\n                num = 1;\n            }\n            for (let i=0; i<num; i++) {\n                let e = cc.instantiate(p);\n                pool.put(e);\n            }\n        }\n\n        // 创建通用特效对象池\n        this.normalEffPool = new cc.NodePool(\"NormalEffect\");\n        for (let i=0; i<this.normalEffectCounts; i++) {\n            let e = cc.instantiate(this.normalEffectPF);\n            this.normalEffPool.put(e);\n        }\n\n        // 创建掉血label对象池\n        this.bloodDecPool = new cc.NodePool();\n        for (let i=0; i<this.normalEffectCounts; i++) {\n            let b = cc.instantiate(this.bloodDecreasePF);\n            this.bloodDecPool.put(b);\n        }\n\n        // 创建敌人2的提示警告对象池\n        this.warningEnemy2Pool = new cc.NodePool();\n        for (let i=0; i<this.warningEnemy2Counts; i++) {\n            let w = cc.instantiate(this.warningEnemy2PF);\n            this.warningEnemy2Pool.put(w);\n        }\n    },\n\n    /**\n     * 获取子弹（需要初始化)\n     * @param name{String} 节点名字\n     * @returns {*}\n     */\n    getBullet(name) {\n        cc.assert(this.bulletPoolDic[name], \"错误的Bullet name: \" + name + \"，找不到对应的pool\");\n        let size = this.bulletPoolDic[name].size();\n        if (size <= 0) {\n            let b = cc.instantiate(this.bulletPFDic[name]);\n            return b;\n        }\n        myLog(name + \" pool size =\" + size);\n        return this.bulletPoolDic[name].get();\n    },\n\n    /**\n     *\n     * @param node{cc.Node} 子弹node\n     */\n    putBullet(node) {\n        let name = node.name;\n        cc.assert(this.bulletPoolDic[name], \"错误的Bullet, name: \" + name + \"，找不到对应的pool\");\n        this.bulletPoolDic[name].put(node);\n\n        let size = this.bulletPoolDic[name].size();\n        myLog(name + \" pool size =\" + size);\n    },\n\n\n    /**\n     * 获取敌人(需要初始化)\n     * @param name\n     * @returns {*}\n     */\n    getEnmey(name) {\n        cc.assert(this.enemyPoolDic[name], \"错误的Enemy name: \" + name + \"，找不到对应的pool\");\n        let size = this.enemyPoolDic[name].size();\n        if (size <= 0) {\n            let e = cc.instantiate(this.enemyPFDic[name]);\n            return e;\n        }\n        myLog(name + \" pool size =\" + size);\n        return this.enemyPoolDic[name].get();\n    },\n\n    putEnemy(node) {\n        let name = node.name;\n        cc.assert(this.enemyPoolDic[name], \"错误的Enemy, name: \" + name + \"，找不到对应的pool\");\n        this.enemyPoolDic[name].put(node);\n\n        let size = this.enemyPoolDic[name].size();\n        myLog(name + \" pool size =\" + size);\n    },\n\n    // 获取一般特效（击中/敌人死亡/boss死亡）\n    getNormalEffect() {\n        let size = this.normalEffPool.size();\n        if (size <= 0) {\n            let e = cc.instantiate(this.normalEffectPF);\n            return e;\n        }\n        // myLog(\"normalEffPool size =\" + size);\n        return this.normalEffPool.get();\n    },\n\n    putNormalEffect(node) {\n        this.normalEffPool.put(node);\n        // let size = this.normalEffPool.size();\n        // myLog(\"normalEffPool size =\" + size);\n    },\n\n    // 获取敌人掉血label节点\n    getBloodDecNode() {\n        let size = this.bloodDecPool.size();\n        if (size <= 0) {\n            let b = cc.instantiate(this.bloodDecreasePF);\n            return b;\n        }\n        myLog(\"bloodDecPool size =\" + size);\n        return this.bloodDecPool.get();\n    },\n\n    putBloodDecNode(node) {\n        this.bloodDecPool.put(node);\n        myLog(\"bloodDecPool size =\" + this.bloodDecPool.size());\n    },\n\n    // 获取敌人2的提示警告节点\n    getWarningEnemy2DecNode() {\n        let size = this.warningEnemy2Pool.size();\n        if (size <= 0) {\n            let b = cc.instantiate(this.warningEnemy2PF);\n            return b;\n        }\n        // cc.log(\"warningEnemy2Pool get size =\" + size);\n        return this.warningEnemy2Pool.get();\n    },\n\n    putWarningEnemy2DecNode(node) {\n        this.warningEnemy2Pool.put(node);\n        // cc.log(\"warningEnemy2Pool put size =\" + this.warningEnemy2Pool.size());\n    }\n});\n\n"]}