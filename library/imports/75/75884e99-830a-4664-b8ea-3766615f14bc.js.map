{"version":3,"sources":["../../../../../../assets/scripts/framework/common/assets/scripts/framework/common/Guide.js"],"names":["OPEN_GUIDE","RENEW","CFG","zy","guide","hit","name","showMask","click","showNext","slideTower","setTimeout","look","cc","Class","extends","Component","statics","init","params","log","step","stepList","cb","openStatus","node","maskNode","setStep","setOpenStatus","status","getOpenStatus","getNextStep","addStep","length","push","checkGuide","data","utils","clone","shift","clean","hideMask","hitNode","ui","seekChildByName","director","getSceneCanvas","seq","sequence","delayTime","callFunc","runAction","lastScale","scale","lastPos","position","lastParent","parent","lastZIndex","zIndex","worldPos","convertToWorldSpaceAR","convertToNodeSpaceAR","animation","getComponent","Animation","play","JSON","stringify","createMaskNode","digging","hitClick","off","Node","EventType","TOUCH_START","setCurrentTime","stop","isValid","destroy","on","slideAniNode","loader","loadRes","Prefab","err","pf","aniNode","instantiate","createNode","v2","cr","Math","max","width","height","hitPos","pos","mask","addComponent","Mask","type","Type","RECT","inverted","_graphics","lineWidth","strokeColor","color","fillColor","circle","x","y","fill","stroke","blackNode","Sprite","updateNode","url","constData","DesignSize","checkStatus","Button","ZIndex","GUIDE","getUiRoot","touchAction","active","isShowMask"],"mappings":"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","file":"Guide.js","sourceRoot":"../../../../../../assets/scripts/framework/common","sourcesContent":["/**\n * Created by skyxu on 2019/12/12.\n */\n\n/**\n * 引导配置\n */\n\n// 引导全局开关\nconst OPEN_GUIDE = true;\n\nconst RENEW = {\n    0: [1001, 1002],  // 开始引导 滑动创建炮塔\n    1: [1001, 1003, 1004], // 引导升级炮塔\n    2: [1005, 1006, 1007, 1008, 1009],  // 引导点击各技能按钮\n    3: [1010, 1011],  // 引导升级血量\n    4: [1012, 1013],  // 引导领取免费金币\n};\n\nconst CFG = {};\n\n// 引导点击炮塔升级按钮\nCFG[1001] = ()=>{\n    zy.guide.hit({\n        name: \"guide_button2\",\n        showMask: true,\n        click: ()=>{\n            zy.guide.showNext();\n        }\n    });\n};\n\n// 引导拖动建造激光炮\nCFG[1002] = ()=>{\n    zy.guide.slideTower({\n        name: \"guide_weapon_2\",\n        showMask: true,\n        click: ()=>{\n            zy.guide.showNext();\n        }\n    });\n};\n\n// 引导点击加特林\nCFG[1003] = ()=>{\n    zy.guide.hit({\n        name: \"guide_weapon_0\",\n        showMask: true,\n        click: ()=>{\n            zy.guide.showNext();\n        }\n    });\n};\n\n// 引导点击升级按钮\nCFG[1004] = ()=>{\n    zy.guide.hit({\n        name: \"guide_upgradeBtn\",\n        showMask: true,\n        click: ()=>{\n            zy.guide.showNext();\n        }\n    });\n};\n\n// 引导点击广告按钮加时间\nCFG[1005] = ()=>{\n    zy.guide.hit({\n        name: \"guide_skill_1\",\n        showMask: true,\n        click: ()=>{\n            zy.guide.showNext();\n        }\n    });\n};\n\n// 引导点击技能1\nCFG[1006] = ()=>{\n    zy.guide.hit({\n        name: \"guide_skill_2\",\n        showMask: true,\n        click: ()=>{\n            setTimeout(()=>{\n                zy.guide.showNext();\n            }, 500);\n        }\n    });\n};\n\n// 引导点击技能2\nCFG[1007] = ()=>{\n    zy.guide.hit({\n        name: \"guide_skill_3\",\n        showMask: true,\n        click: ()=>{\n            setTimeout(()=>{\n                zy.guide.showNext();\n            }, 500);\n        }\n    });\n};\n\n// 引导点击技能3\nCFG[1008] = ()=>{\n    zy.guide.hit({\n        name: \"guide_button_add_time\",\n        showMask: true,\n        click: ()=>{\n            setTimeout(()=>{\n                zy.guide.showNext();\n            }, 500);\n        }\n    });\n};\n\n// 引导查看倒计时\nCFG[1009] = ()=>{\n    zy.guide.look({\n        name: \"guide_skill_progressBar\",\n        showMask: true,\n        click: ()=>{\n            zy.guide.showNext();\n            // let GameManager = require(\"GameManager\");\n            // GameManager.setGamePauseLogic(false);\n        }\n    });\n};\n\n// 主ui升级血量\nCFG[1010] = ()=> {\n    zy.guide.hit({\n        name: \"guide_button1\",\n        showMask: true,\n        click: ()=>{\n            zy.guide.showNext();\n        }\n    });\n};\n\n// 升级血量\nCFG[1011] = ()=> {\n    zy.guide.hit({\n        name: \"guide_upgrade_hp\",\n        showMask: true,\n        click: ()=>{\n            zy.guide.showNext();\n        }\n    });\n};\n\n// 主ui免费金币\nCFG[1012] = ()=> {\n    zy.guide.hit({\n        name: \"guide_button3\",\n        showMask: true,\n        click: ()=>{\n            zy.guide.showNext();\n        }\n    });\n};\n\nCFG[1013] = ()=> {\n    zy.guide.hit({\n        name: \"guide_free_coins\",\n        showMask: true,\n        click: ()=>{\n            setTimeout(()=>{\n                zy.guide.showNext();\n            }, 500);\n        }\n    });\n};\n\ncc.Class({\n    extends: cc.Component,\n\n    statics: {\n        OPEN_GUIDE: OPEN_GUIDE,\n        CFG: CFG,\n\n        init(params) {\n            cc.log(\"===init guide: \", params);\n            this.step = params.step;  // 当前步数\n            this.stepList = [];\n            this.cb = null;\n\n            if (this.step == 1001) {\n                this.step = 0;\n            }\n\n            if (this.OPEN_GUIDE) {\n                this.openStatus = true;\n            } else {\n                this.openStatus = false;\n            }\n\n            // if (this.OPEN_GUIDE && this.step == 0) {\n            //     this.openStatus = true;\n            // } else {\n            //     this.openStatus = false;\n            //     if (this.step < 8901) {\n            //         this.step = 8901;\n            //         // 告诉服务器\n            //     }\n            // }\n\n            this.node = null;\n            this.maskNode = null;\n        },\n\n        setStep(step) {\n            this.step = step;\n        },\n\n        setOpenStatus(status) {\n            this.openStatus = status;\n        },\n\n        getOpenStatus() {\n            return this.openStatus;\n        },\n\n        getNextStep: function () {\n            if (!zy.guide.getOpenStatus() || !OPEN_GUIDE) {\n                return;\n            }\n            return this.stepList[0];\n        },\n\n        addStep: function (step) {\n            if (this.stepList.length == 0) {\n                this.stepList.push(step);\n            }\n        },\n\n        checkGuide: function () {\n            let data = RENEW[this.step];\n            if (data) {\n                this.stepList = zy.utils.clone(data);\n                zy.guide.showNext();\n            }\n        },\n\n        showNext(step, node) {\n            if (!zy.guide.getOpenStatus() || !OPEN_GUIDE) {\n                return;\n            }\n            if (step) {\n                this.CFG[step](node);\n            } else {\n                let step = this.stepList.shift();\n                if (step == null) {\n                    zy.guide.clean();\n                } else {\n                    this.step = step;\n                    cc.log('zy.guide.show', step);\n                    this.CFG[this.step]();\n                }\n            }\n        },\n\n        // 引导点击\n        hit(params) {\n            this.hideMask();\n            // 节点全局唯一名字\n            let name = params.name;\n\n            let hitNode = zy.ui.seekChildByName(zy.director.getSceneCanvas(), name);\n            if (!hitNode) {\n                let seq = cc.sequence(\n                    cc.delayTime(0.5),\n                    cc.callFunc(()=>{\n                        this.hit(params);\n                    })\n                );\n                this.node.runAction(seq);\n                return;\n            }\n\n            let lastScale = hitNode.scale; // 计算worldPos时必须以1运算\n            let lastPos = hitNode.position;\n            let lastParent = hitNode.parent;\n            let lastZIndex = hitNode.zIndex;\n            let worldPos = lastParent.convertToWorldSpaceAR(lastPos);\n            hitNode.parent = this.node; // 改变层级\n            hitNode.position = this.node.convertToNodeSpaceAR(worldPos);\n            hitNode.zIndex = 1;\n            hitNode.scale = lastScale;\n\n            let animation = hitNode.getComponent(cc.Animation);\n            if (animation) {\n                animation.play(\"guide_shake\", 0);\n            }\n\n            cc.log(\"===oriPos:\" + JSON.stringify(lastPos));\n\n            cc.log(\"===newPos:\" + JSON.stringify(hitNode.position));\n\n            let maskNode = null;\n            if (params.showMask) {\n                maskNode = this.createMaskNode(hitNode, this.node, params.digging);\n            }\n\n            let hitClick = ()=> {\n                cc.log(\"===click guide hit node\");\n                hitNode.off(cc.Node.EventType.TOUCH_START, hitClick, this, true);\n                hitNode.parent = lastParent;\n                hitNode.position = lastPos;\n                hitNode.zIndex = lastZIndex;\n\n                if (animation) {\n                    animation.setCurrentTime(0, 'guide_shake');\n                    animation.stop(\"guide_shake\");\n                }\n\n                if (cc.isValid(maskNode)) {\n                    maskNode.destroy();\n                }\n\n                if (params.click) {\n                    params.click();\n                }\n            };\n            hitNode.on(cc.Node.EventType.TOUCH_START, hitClick, this, true);\n        },\n\n        slideTower(params) {\n            this.hideMask();\n            let name = params.name;\n            let hitNode = zy.ui.seekChildByName(zy.director.getSceneCanvas(), name);\n            if (!hitNode) {\n                let seq = cc.sequence(\n                    cc.delayTime(0.5),\n                    cc.callFunc(()=>{\n                        this.slideTower(params);\n                    })\n                );\n                this.node.runAction(seq);\n                return;\n            }\n\n            let lastScale = hitNode.scale; // 计算worldPos时必须以1运算\n            let lastPos = hitNode.position;\n            let lastParent = hitNode.parent;\n            let lastZIndex = hitNode.zIndex;\n            let worldPos = lastParent.convertToWorldSpaceAR(lastPos);\n            hitNode.parent = this.node; // 改变层级\n            hitNode.position = this.node.convertToNodeSpaceAR(worldPos);\n            hitNode.zIndex = 1;\n            hitNode.scale = lastScale;\n\n            let maskNode = null;\n            if (params.showMask) {\n                maskNode = this.createMaskNode(hitNode, this.node, params.digging);\n            }\n\n            let hitClick = ()=> {\n                this.node.off(cc.Node.EventType.TOUCH_START, hitClick, this, true);\n\n                hitNode.parent = lastParent;\n                hitNode.position = lastPos;\n                hitNode.zIndex = lastZIndex;\n\n                this.slideAniNode.destroy();\n\n                if (cc.isValid(maskNode)) {\n                    maskNode.destroy();\n                }\n\n                if (params.click) {\n                    params.click();\n                }\n            };\n\n            cc.loader.loadRes(\"MainGame/Ui/gun_drag\", cc.Prefab, (err, pf)=>{\n                if (err) {\n                    cc.log(err);\n                } else {\n                    let aniNode = this.slideAniNode = cc.instantiate(pf);\n                    aniNode.zIndex = 2;\n                    aniNode.parent = this.node;\n                    aniNode.position = this.node.convertToNodeSpaceAR(hitNode.parent.convertToWorldSpaceAR(hitNode.position));\n                    aniNode.getComponent(cc.Animation).play(\"guide_drag\", 0);\n                    this.node.on(cc.Node.EventType.TOUCH_START, hitClick, this, true);\n                }\n            });\n        },\n\n        // 引导查看某节点，点击屏幕任意位置结束\n        look(params) {\n            this.hideMask();\n            // 节点全局唯一名字\n            let name = params.name;\n\n            let hitNode = zy.ui.seekChildByName(zy.director.getSceneCanvas(), name);\n            if (!hitNode) {\n                let seq = cc.sequence(\n                    cc.delayTime(0.5),\n                    cc.callFunc(()=>{\n                        this.hit(params);\n                    })\n                );\n                this.node.runAction(seq);\n                return;\n            }\n\n            let lastScale = hitNode.scale; // 计算worldPos时必须以1运算\n            let lastPos = hitNode.position;\n            let lastParent = hitNode.parent;\n            let lastZIndex = hitNode.zIndex;\n            let worldPos = lastParent.convertToWorldSpaceAR(lastPos);\n            hitNode.parent = this.node; // 改变层级\n            hitNode.position = this.node.convertToNodeSpaceAR(worldPos);\n            hitNode.zIndex = 1;\n            hitNode.scale = lastScale;\n            cc.log(\"===oriPos:\" + JSON.stringify(lastPos));\n\n            cc.log(\"===newPos:\" + JSON.stringify(hitNode.position));\n\n            let maskNode = null;\n            if (params.showMask) {\n                maskNode = this.createMaskNode(hitNode, this.node, params.digging);\n            }\n\n            let hitClick = ()=> {\n                cc.log(\"===click guide look node\");\n                this.node.off(cc.Node.EventType.TOUCH_START, hitClick, this, true);\n                hitNode.parent = lastParent;\n                hitNode.position = lastPos;\n                hitNode.zIndex = lastZIndex;\n\n                if (cc.isValid(maskNode)) {\n                    maskNode.destroy();\n                }\n\n                if (params.click) {\n                    params.click();\n                }\n            };\n            this.node.on(cc.Node.EventType.TOUCH_START, hitClick, this, true);\n        },\n\n        /**\n         * 创建黑色遮罩\n         * @param hitNode\n         * @param parent\n         * @param digging {boolean} 是否挖孔显示\n         */\n        createMaskNode: function (hitNode, parent, digging) {\n            // mask节点\n            let maskNode = zy.Node.createNode({\n                name: \"guideMaskNode\",\n                parent: parent,\n                position: cc.v2(0,0),\n            });\n\n            if (digging) {\n                let cr = Math.max(hitNode.width, hitNode.height);\n                let hitPos = hitNode.parent.convertToWorldSpaceAR(hitNode.position);\n                let pos = maskNode.convertToNodeSpaceAR(hitPos);\n\n                let mask = maskNode.addComponent(cc.Mask);\n                mask.type = cc.Mask.Type.RECT;\n                mask.inverted = true;\n                // 私有api\n                mask._graphics.lineWidth = 1;\n                mask._graphics.strokeColor = cc.color(255, 0, 0);\n                mask._graphics.fillColor = cc.color(0, 255, 0);\n                mask._graphics.circle(pos.x, pos.y, cr*0.5);\n                mask._graphics.fill();\n                mask._graphics.stroke();\n            }\n\n            // 半透明精灵\n            let blackNode = zy.Node.createNode({\n                parent: maskNode,\n                position: cc.v2(0, 0),\n            });\n            blackNode.addComponent(zy.Sprite);\n            zy.Sprite.updateNode(blackNode, {\n                url: \"textures/common/guide/guide_mask\",\n                width: zy.constData.DesignSize.width * 1.5,\n                height: zy.constData.DesignSize.height * 1.5,\n            });\n\n            return maskNode;\n        },\n\n        // 检查遮罩（阻挡触摸)\n        checkStatus() {\n            if (!this.openStatus) {\n                return;\n            }\n\n            if (!cc.isValid(this.node)) {\n                this.node = zy.Button.createNode({\n                    name: \"guideNode\",\n                    zIndex: zy.constData.ZIndex.GUIDE,\n                    parent: zy.director.getUiRoot(),\n                    touchAction: false,\n                    width: zy.constData.DesignSize.width * 2,\n                    height: zy.constData.DesignSize.height * 2,\n                });\n            }\n        },\n\n        hideMask() {\n            if (cc.isValid(this.maskNode)) {\n                this.maskNode.active = false;\n            }\n        },\n\n        // 添加遮罩\n        showMask: function () {\n            if (!this.openStatus) return;\n            this.maskNode.active = true;\n        },\n\n        isShowMask: function () {\n            if (cc.isValid(this.node) && cc.isValid(this.maskNode)) {\n                return this.node.active && this.maskNode.active;\n            } else {\n                return false;\n            }\n        },\n\n        clean: function () {\n            this.openStatus = false;\n            this.step = -1;\n\n            if (cc.isValid(this.node)) {\n                this.node.destroy();\n                this.node = null;\n            }\n        },\n\n    }\n});"]}