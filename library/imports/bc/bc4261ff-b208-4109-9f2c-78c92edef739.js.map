{"version":3,"sources":["../../../../../../assets/scripts/framework/common/assets/scripts/framework/common/Audio.js"],"names":["BGM","MAIN","Effect","CommonClick","cc","Class","statics","init","curBGMUrl","curBGMClip","bgmVolume","effVolume","bgmEnabled","effEnabled","sys","localStorage","getItem","parseFloat","audioEngine","setMusicVolume","setEffectsVolume","getCurBGMUrl","playBGM","url","force","uncache","loader","loadRes","AudioClip","err","clip","playMusic","pauseBGM","pauseMusic","resumeBGM","resumeMusic","stopBGM","stopMusic","playEffect","loop","pauseAllEffects","resumeAllEffects","stopALlEffects","stopAllEffects","uncacheAll","pauseAll","resumeAll","stopAll","setBGMEnabled","enabled","setItem","String","getBGMEnabled","setBGMVolume","v","getBGMVomue","setEffectsEnabled","getEffectsEnabled","getEffectVolume","clean"],"mappings":"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","file":"Audio.js","sourceRoot":"../../../../../../assets/scripts/framework/common","sourcesContent":["/**\r\n * Created by skyxu on 2019/12/26.\r\n */\r\n\r\nconst BGM = {\r\n    MAIN: \"sounds/bgm/main\",\r\n};\r\n\r\nconst Effect = {\r\n    CommonClick: \"sounds/effect/common_click\",\r\n};\r\n\r\ncc.Class({\r\n    statics: {\r\n        BGM: BGM,\r\n        Effect: Effect,\r\n\r\n        init () {\r\n            this.curBGMUrl = null;\r\n            this.curBGMClip = null;\r\n\r\n            this.bgmVolume = 0.9;\r\n            this.effVolume = 1;\r\n            this.bgmEnabled = true;\r\n            this.effEnabled = true;\r\n\r\n            const bgmEnabled = cc.sys.localStorage.getItem('bgmEnabled');\r\n            if (bgmEnabled != null && bgmEnabled == 'false') {\r\n                this.bgmEnabled = false;\r\n            }\r\n\r\n            const bgmVolume = cc.sys.localStorage.getItem('bgmVolume');\r\n            if (bgmVolume != null) {\r\n                this.bgmVolume = parseFloat(bgmVolume);\r\n                cc.audioEngine.setMusicVolume(bgmVolume);\r\n            }\r\n\r\n            const effEnabled = cc.sys.localStorage.getItem('effEnabled');\r\n            if (effEnabled != null && effEnabled == 'false') {\r\n                this.effEnabled = false;\r\n            }\r\n\r\n            const effVolume = cc.sys.localStorage.getItem('effVolume');\r\n            if (effVolume != null) {\r\n                this.effVolume = parseFloat(effVolume);\r\n                cc.audioEngine.setEffectsVolume(effVolume);\r\n            }\r\n        },\r\n\r\n        // 当前bgmurl\r\n        getCurBGMUrl: function () {\r\n            return this.curBGMUrl;\r\n        },\r\n\r\n        playBGM (url, force) {\r\n            // 如果已经在播放就不播了\r\n            if (this.curBGMUrl && this.curBGMUrl == url && !force) {\r\n                return;\r\n            }\r\n\r\n            this.curBGMUrl = url;\r\n\r\n            if (!this.bgmEnabled) {\r\n                return;\r\n            }\r\n\r\n            if (this.curBGMClip) {\r\n                this.uncache(this.curBGMClip);\r\n            }\r\n\r\n            cc.loader.loadRes(url, cc.AudioClip, (err, clip)=>{\r\n                if (!err) {\r\n                    this.curBGMClip = clip;\r\n                    cc.audioEngine.playMusic(clip, true);\r\n                }\r\n            });\r\n        },\r\n\r\n        pauseBGM () {\r\n            cc.audioEngine.pauseMusic();\r\n        },\r\n\r\n        resumeBGM () {\r\n            cc.audioEngine.resumeMusic();\r\n        },\r\n\r\n        stopBGM () {\r\n            cc.audioEngine.stopMusic();\r\n        },\r\n\r\n        playEffect (url, loop=false) {\r\n            if (!this.effEnabled) {\r\n                return;\r\n            }\r\n\r\n            cc.loader.loadRes(url, cc.AudioClip, (err, clip)=>{\r\n                if (!err) {\r\n                    cc.audioEngine.playEffect(clip, loop);\r\n                }\r\n            });\r\n        },\r\n\r\n        pauseAllEffects() {\r\n            cc.audioEngine.pauseAllEffects();\r\n        },\r\n\r\n        resumeAllEffects () {\r\n            cc.audioEngine.resumeAllEffects();\r\n        },\r\n\r\n        stopALlEffects () {\r\n            cc.audioEngine.stopAllEffects();\r\n        },\r\n\r\n        uncache (clip) {\r\n            cc.audioEngine.uncache(clip);\r\n        },\r\n\r\n        uncacheAll () {\r\n            cc.audioEngine.uncacheAll();\r\n        },\r\n\r\n        pauseAll () {\r\n            cc.audioEngine.pauseAll();\r\n        },\r\n\r\n        resumeAll () {\r\n            cc.audioEngine.resumeAll();\r\n        },\r\n\r\n        stopAll () {\r\n            cc.audioEngine.stopAll();\r\n        },\r\n\r\n        setBGMEnabled (enabled) {\r\n            if (this.bgmEnabled != enabled) {\r\n                cc.sys.localStorage.setItem('bgmEnabled', String(enabled));\r\n                this.bgmEnabled = enabled;\r\n                if (this.bgmEnabled == true && this.curBGMUrl != null) {\r\n                    this.playBGM(this.curBGMUrl, true);\r\n                } else {\r\n                    this.stopBGM();\r\n                }\r\n            }\r\n        },\r\n\r\n        getBGMEnabled () {\r\n            return this.bgmEnabled;\r\n        },\r\n\r\n        setBGMVolume (v) {\r\n            if (this.bgmVolume != v) {\r\n                cc.sys.localStorage.setItem('bgmVolume', v);\r\n                this.bgmVolume = v;\r\n                cc.audioEngine.setMusicVolume(v);\r\n            }\r\n        },\r\n\r\n        getBGMVomue () {\r\n            return this.bgmVolume;\r\n        },\r\n\r\n        setEffectsEnabled (enabled) {\r\n            if (this.effEnabled != enabled) {\r\n                cc.sys.localStorage.setItem('effEnabled', String(enabled));\r\n                this.effEnabled = enabled;\r\n                if (!enabled) {\r\n                    this.stopALlEffects();\r\n                }\r\n            }\r\n        },\r\n\r\n        getEffectsEnabled () {\r\n            return this.effEnabled;\r\n        },\r\n\r\n        setEffectsVolume (v) {\r\n            if (this.effVolume != v) {\r\n                cc.sys.localStorage.setItem('effVolume', v);\r\n                this.effVolume = v;\r\n                cc.audioEngine.setEffectsVolume(this.effVolume);\r\n            }\r\n        },\r\n\r\n        getEffectVolume () {\r\n            return this.effVolume;\r\n        },\r\n\r\n        clean () {\r\n            this.stopAll();\r\n            this.uncacheAll();\r\n            this.curBGMUrl = null;\r\n            this.curBGMClip = null;\r\n        }\r\n    }\r\n});"]}